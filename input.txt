import pandas as pd
from openpyxl import load_workbook

def excel_to_markdown(file_path, sheet_name=0):
    # Load the workbook and the specified sheet
    wb = load_workbook(file_path, data_only=True)
    sheet = wb[sheet_name] if isinstance(sheet_name, str) else wb.worksheets[sheet_name]
    
    # Extract merged cell ranges
    merged_cells = list(sheet.merged_cells.ranges)  # Ensure it is a list
    merged_map = {}
    
    for merged_range in merged_cells:
        min_col, min_row, max_col, max_row = merged_range.min_col, merged_range.min_row, merged_range.max_col, merged_range.max_row
        main_value = sheet.cell(row=min_row, column=min_col).value
        for row in range(min_row, max_row + 1):
            for col in range(min_col, max_col + 1):
                merged_map[(row, col)] = main_value
    
    # Convert sheet data to a list of lists
    data = []
    for row in sheet.iter_rows():
        row_data = []
        for cell in row:
            row_data.append(merged_map.get((cell.row, cell.column), cell.value))
        data.append(row_data)
    
    # Convert data into Markdown format
    df = pd.DataFrame(data)
    markdown_table = df.to_markdown(index=False, headers=False)
    
    return markdown_table

# Example usage
file_path = "example.xlsx"  # Replace with your actual file path
sheet_name = 0  # Replace with your sheet name or index
markdown_output = excel_to_markdown(file_path, sheet_name)
print(markdown_output)
